<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Teka Teki Silang (TTS)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Styles */
        .cell {
            width: 30px;
            height: 30px;
            border: 1px solid #333;
            text-align: center;
            text-transform: uppercase;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .cell input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            text-transform: uppercase;
            background: transparent;
            outline: none;
            font-size: 1.2rem;
            padding: 0;
        }
        .cell.black {
            background-color: #333;
            border: 1px solid #333;
            cursor: default;
        }
        .cell.active {
            background-color: #fff7ed; /* orange-50 */
        }
        .cell.focused {
            background-color: #fbd38d; /* orange-200 */
        }
        .cell-number {
            position: absolute;
            top: 1px;
            left: 1px;
            font-size: 8px;
            line-height: 1;
            color: #555;
            pointer-events: none;
        }
        /* Hide scrollbar for clean look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans text-gray-800">
    <!-- App Container -->
    <div id="app" class="max-w-md mx-auto bg-white min-h-screen shadow-xl relative overflow-hidden">

        <!-- HEADER -->
        <header class="bg-blue-600 text-white p-4 shadow-md z-10 relative">
            <h1 class="text-xl font-bold text-center">Game TTS Seru</h1>
        </header>

        <!-- SCREENS -->

        <!-- MAIN MENU -->
        <div id="screen-menu" class="p-6 space-y-4">
            <h2 class="text-2xl font-bold text-center mb-6 text-blue-700">Pilih Kategori</h2>

            <button onclick="startGame('hewan')" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-xl shadow transition transform hover:scale-105 flex items-center justify-center gap-2">
                üêæ Nama Hewan
            </button>

            <button onclick="startGame('buah')" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-xl shadow transition transform hover:scale-105 flex items-center justify-center gap-2">
                üçé Nama Buah
            </button>

            <button onclick="startGame('kota')" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-xl shadow transition transform hover:scale-105 flex items-center justify-center gap-2">
                üèôÔ∏è Nama Kota
            </button>

            <button onclick="startGame('umum')" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-4 rounded-xl shadow transition transform hover:scale-105 flex items-center justify-center gap-2">
                üß† Pengetahuan Umum
            </button>

            <div class="pt-4 border-t border-gray-200"></div>

            <button onclick="showLeaderboard()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-xl shadow transition transform hover:scale-105 flex items-center justify-center gap-2">
                üèÜ Leaderboard
            </button>

            <button onclick="showContest()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-xl shadow transition transform hover:scale-105 flex items-center justify-center gap-2">
                üéÅ Info Kontes
            </button>
        </div>

        <!-- GAME SCREEN -->
        <div id="screen-game" class="hidden flex flex-col h-full">
            <div class="p-2 bg-blue-50 flex justify-between items-center border-b">
                <button onclick="showMenu()" class="text-blue-600 font-bold text-sm hover:underline">‚Üê Menu</button>
                <div class="font-mono font-bold text-lg text-blue-800" id="timer">00:00</div>
                <button onclick="giveUp()" class="text-red-500 font-bold text-sm hover:underline">Menyerah</button>
            </div>

            <div class="p-4 flex-grow overflow-y-auto">
                <!-- Grid Container -->
                <div id="grid-container" class="mx-auto bg-black p-1 border-2 border-gray-800 shadow-lg mb-6" style="width: fit-content;">
                    <!-- Grid will be generated here -->
                </div>

                <!-- Clues -->
                <div class="space-y-4">
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                        <h3 class="font-bold text-blue-800 mb-1 text-sm">MENDATAR</h3>
                        <ul id="clues-across" class="text-sm text-gray-700 space-y-1 list-decimal list-inside"></ul>
                    </div>
                    <div class="bg-green-50 p-3 rounded-lg border border-green-100">
                        <h3 class="font-bold text-green-800 mb-1 text-sm">MENURUN</h3>
                        <ul id="clues-down" class="text-sm text-gray-700 space-y-1 list-decimal list-inside"></ul>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-white border-t border-gray-200">
                <button onclick="checkAnswers()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition">
                    Cek Jawaban
                </button>
            </div>
        </div>

        <!-- LEADERBOARD SCREEN -->
        <div id="screen-leaderboard" class="hidden p-6">
            <button onclick="showMenu()" class="mb-4 text-blue-600 font-bold hover:underline">‚Üê Kembali</button>
            <h2 class="text-2xl font-bold text-center mb-6 text-yellow-600">üèÜ Papan Peringkat</h2>

            <div class="bg-white rounded-lg shadow overflow-hidden border border-gray-200">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th class="px-4 py-3">Nama</th>
                            <th class="px-4 py-3">Kategori</th>
                            <th class="px-4 py-3 text-right">Skor</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-list">
                        <!-- Entries go here -->
                    </tbody>
                </table>
                <div id="no-scores" class="p-4 text-center text-gray-500 hidden">Belum ada skor. Mainkan game sekarang!</div>
            </div>
        </div>

        <!-- CONTEST SCREEN -->
        <div id="screen-contest" class="hidden p-6 text-center">
             <button onclick="showMenu()" class="absolute top-4 left-4 text-blue-600 font-bold hover:underline">‚Üê Kembali</button>
             <div class="mt-10">
                <div class="text-6xl mb-4">üéÅ</div>
                <h2 class="text-2xl font-bold text-indigo-700 mb-2">Kontes TTS</h2>
                <p class="text-gray-600 mb-6">Nantikan kontes berhadiah menarik di update selanjutnya!</p>
                <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100 text-left">
                    <h3 class="font-bold text-indigo-800 mb-2">Rencana Kedepan:</h3>
                    <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                        <li>Turnamen Mingguan</li>
                        <li>Hadiah Saldo E-Wallet</li>
                        <li>Kategori Spesial</li>
                    </ul>
                </div>
             </div>
        </div>

        <!-- RESULT MODAL -->
        <div id="modal-result" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full text-center transform transition-all scale-100">
                <div class="text-5xl mb-4" id="result-icon">üéâ</div>
                <h2 class="text-2xl font-bold mb-2" id="result-title">Selamat!</h2>
                <p class="text-gray-600 mb-4" id="result-message">Kamu menyelesaikan TTS ini.</p>

                <div id="score-entry" class="hidden mb-4 text-left">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Masukkan Nama Kamu:</label>
                    <input type="text" id="player-name" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Nama Pemenang">
                </div>

                <div class="flex gap-2 justify-center">
                    <button onclick="closeModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">Tutup</button>
                    <button id="save-btn" onclick="saveScore()" class="hidden bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Simpan Skor</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // DATA WORDS
        const wordData = {
            hewan: [
                { word: "GAJAH", clue: "Hewan darat terbesar" },
                { word: "SINGA", clue: "Raja hutan" },
                { word: "KUCING", clue: "Hewan berbulu yang suka mengeong" },
                { word: "ULAR", clue: "Reptil panjang tidak berkaki" },
                { word: "BURUNG", clue: "Hewan bersayap bisa terbang" },
                { word: "IKAN", clue: "Bernapas dengan insang" },
                { word: "AYAM", clue: "Berkokok di pagi hari" },
                { word: "KELINCI", clue: "Suka makan wortel" },
                { word: "HARIMAU", clue: "Kucing besar belang-belang" },
                { word: "BUAYA", clue: "Reptil buas di sungai" }
            ],
            buah: [
                { word: "APEL", clue: "Buah merah, identik dengan kota Malang" },
                { word: "JERUK", clue: "Kaya vitamin C, warna oranye" },
                { word: "PISANG", clue: "Buah kuning melengkung" },
                { word: "ANGGUR", clue: "Buah kecil bergerombol" },
                { word: "DURIAN", clue: "Raja buah, kulit berduri" },
                { word: "MANGGA", clue: "Buah manis, ada jenis Harum Manis" },
                { word: "NANAS", clue: "Buah bersisik, punya mahkota" },
                { word: "SEMANGKA", clue: "Buah besar, daging merah, banyak air" },
                { word: "SALAK", clue: "Kulitnya seperti sisik ular" }
            ],
            kota: [
                { word: "JAKARTA", clue: "Ibukota Indonesia" },
                { word: "BANDUNG", clue: "Kota Kembang" },
                { word: "SURABAYA", clue: "Kota Pahlawan" },
                { word: "MEDAN", clue: "Ibukota Sumatera Utara" },
                { word: "DENPASAR", clue: "Ibukota provinsi Bali" },
                { word: "YOGYAKARTA", clue: "Daerah Istimewa, Kota Pelajar" },
                { word: "SEMARANG", clue: "Ibukota Jawa Tengah" },
                { word: "MAKASSAR", clue: "Ibukota Sulawesi Selatan" },
                { word: "BOGOR", clue: "Kota Hujan" }
            ],
            umum: [
                { word: "AIR", clue: "Dibutuhkan makhluk hidup (H2O)" },
                { word: "API", clue: "Menghasilkan panas dan cahaya" },
                { word: "MATAHARI", clue: "Pusat tata surya" },
                { word: "BULAN", clue: "Satelit alami bumi" },
                { word: "INDONESIA", clue: "Negara kita tercinta" },
                { word: "OKSIGEN", clue: "Gas yang kita hirup" },
                { word: "PELANGI", clue: "Muncul setelah hujan, berwarna-warni" },
                { word: "KOMPUTER", clue: "Alat elektronik untuk mengolah data" }
            ]
        };

        // STATE
        let currentCategory = '';
        let grid = [];
        let placedWords = [];
        let timerInterval;
        let startTime;
        let timeElapsed = 0;
        const gridSize = 12;

        // INIT
        function showScreen(id) {
            document.querySelectorAll('#app > div[id^="screen-"]').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function showMenu() {
            stopTimer();
            showScreen('screen-menu');
        }

        function showLeaderboard() {
            renderLeaderboard();
            showScreen('screen-leaderboard');
        }

        function showContest() {
            showScreen('screen-contest');
        }

        // GAME LOGIC
        function startGame(category) {
            currentCategory = category;
            const words = [...wordData[category]]; // Copy array

            // Generate Grid
            const success = generateCrossword(words);
            if (!success) {
                alert("Gagal membuat level. Silakan coba lagi.");
                return;
            }

            renderGrid();
            startTimer();
            showScreen('screen-game');
        }

        function generateCrossword(wordList) {
            // Sort words by length desc
            wordList.sort((a, b) => b.word.length - a.word.length);

            // Reset Grid
            grid = Array(gridSize).fill(null).map(() => Array(gridSize).fill(null));
            placedWords = [];

            // Place first word in center horizontal
            const first = wordList[0];
            const startRow = Math.floor(gridSize / 2);
            const startCol = Math.floor((gridSize - first.word.length) / 2);

            placeWord(first, startRow, startCol, 'across');

            const remaining = wordList.slice(1);
            let retries = 0;

            // Simple greedy placement
            for (const item of remaining) {
                let placed = false;
                // Try to intersect with existing placed words
                // Shuffle placedWords to add variety if replaying (though this logic is deterministic per sort, shuffling helps if we randomized input)

                for (const pw of placedWords) {
                    if (placed) break;

                    // Find common letters
                    for (let i = 0; i < item.word.length; i++) { // char in new word
                        if (placed) break;
                        for (let j = 0; j < pw.word.length; j++) { // char in placed word
                            if (item.word[i] === pw.word[j]) {
                                // Intersection point
                                const intersectRow = pw.row + (pw.dir === 'down' ? j : 0);
                                const intersectCol = pw.col + (pw.dir === 'across' ? j : 0);

                                // If pw is across, new word must be down, and vice versa
                                const newDir = pw.dir === 'across' ? 'down' : 'across';

                                // Calculate new start position
                                const newRow = intersectRow - (newDir === 'down' ? i : 0);
                                const newCol = intersectCol - (newDir === 'across' ? i : 0);

                                if (canPlace(item.word, newRow, newCol, newDir)) {
                                    placeWord(item, newRow, newCol, newDir);
                                    placed = true;
                                    break;
                                }
                            }
                        }
                    }
                }
            }

            return placedWords.length > 0;
        }

        function canPlace(word, row, col, dir) {
            if (row < 0 || row >= gridSize || col < 0 || col >= gridSize) return false;

            // Check boundaries
            if (dir === 'across') {
                if (col + word.length > gridSize) return false;
            } else {
                if (row + word.length > gridSize) return false;
            }

            // Check collisions
            for (let i = 0; i < word.length; i++) {
                const r = row + (dir === 'down' ? i : 0);
                const c = col + (dir === 'across' ? i : 0);

                const cell = grid[r][c];

                // Cell must be empty OR match the letter
                if (cell !== null && cell !== word[i]) return false;

                // Neighbor checks to prevent adjacent words merging unintentionally
                // If cell is empty, it must not have neighbors on the perpendicular axis (unless it's an intersection which we handle)
                // Actually, a simpler check:
                // For each cell we place, if it was empty, check its neighbors perpendicular to direction.
                // They must be empty.

                if (cell === null) {
                    if (dir === 'across') {
                        // Check up and down
                        if (r > 0 && grid[r-1][c] !== null) return false;
                        if (r < gridSize-1 && grid[r+1][c] !== null) return false;
                    } else {
                        // Check left and right
                        if (c > 0 && grid[r][c-1] !== null) return false;
                        if (c < gridSize-1 && grid[r][c+1] !== null) return false;
                    }
                }
            }

            // Check start and end (cells before and after the word must be empty)
            if (dir === 'across') {
                if (col > 0 && grid[row][col-1] !== null) return false;
                if (col + word.length < gridSize && grid[row][col + word.length] !== null) return false;
            } else {
                if (row > 0 && grid[row-1][col] !== null) return false;
                if (row + word.length < gridSize && grid[row + word.length][col] !== null) return false;
            }

            return true;
        }

        function placeWord(item, row, col, dir) {
            placedWords.push({ ...item, row, col, dir, number: 0 }); // number assigned later
            for (let i = 0; i < item.word.length; i++) {
                const r = row + (dir === 'down' ? i : 0);
                const c = col + (dir === 'across' ? i : 0);
                grid[r][c] = item.word[i];
            }
        }

        function renderGrid() {
            const container = document.getElementById('grid-container');
            container.innerHTML = '';

            // Assign numbers
            placedWords.sort((a,b) => (a.row - b.row) || (a.col - b.col));
            let num = 1;
            placedWords.forEach(pw => {
                // Only assign number if not already assigned at this pos (intersection start)
                // Check if any other word starts here
                const existing = placedWords.find(w => w !== pw && w.row === pw.row && w.col === pw.col && w.number > 0);
                if (existing) {
                    pw.number = existing.number;
                } else {
                    pw.number = num++;
                }
            });

            // Setup Clues
            const acrossList = document.getElementById('clues-across');
            const downList = document.getElementById('clues-down');
            acrossList.innerHTML = '';
            downList.innerHTML = '';

            placedWords.forEach(pw => {
                const li = document.createElement('li');
                li.innerHTML = `<b>${pw.number}.</b> ${pw.clue}`;
                if (pw.dir === 'across') acrossList.appendChild(li);
                else downList.appendChild(li);
            });

            // Draw DOM Grid
            // Find bounds to center the view or just use fixed size
            // We use fixed 12x12 grid
            container.style.display = 'grid';
            container.style.gridTemplateColumns = `repeat(${gridSize}, 30px)`;
            container.style.gridTemplateRows = `repeat(${gridSize}, 30px)`;

            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const cellDiv = document.createElement('div');
                    const char = grid[r][c];

                    if (char === null) {
                        cellDiv.className = 'cell black';
                    } else {
                        cellDiv.className = 'cell bg-white';
                        
                        // Check if a word starts here
                        const starts = placedWords.filter(pw => pw.row === r && pw.col === c);
                        if (starts.length > 0) {
                            const numSpan = document.createElement('span');
                            numSpan.className = 'cell-number';
                            numSpan.innerText = starts[0].number;
                            cellDiv.appendChild(numSpan);
                        }

                        const input = document.createElement('input');
                        input.maxLength = 1;
                        input.dataset.row = r;
                        input.dataset.col = c;
                        input.dataset.answer = char; // For debugging/checking
                        
                        // Input logic
                        input.addEventListener('focus', () => cellDiv.classList.add('focused'));
                        input.addEventListener('blur', () => cellDiv.classList.remove('focused'));
                        input.addEventListener('keyup', (e) => handleInput(e, r, c));

                        cellDiv.appendChild(input);
                    }
                    container.appendChild(cellDiv);
                }
            }
        }

        function handleInput(e, r, c) {
            const inputs = document.querySelectorAll('input');
            const current = e.target;

            // If key is a letter, move to next input based on direction preference?
            // This is tricky without knowing user intent. Simple approach: move right then down if blocked?
            // Or just use arrow keys.

            if (e.key.match(/^[a-zA-Z]$/)) {
                current.value = e.key.toUpperCase();
                // Auto focus next? We don't easily know "next" in which word.
                // We can just let user click or use arrows.
                // Let's try basic Right move
                // find input at r, c+1
                /*
                const next = document.querySelector(`input[data-row="${r}"][data-col="${c+1}"]`);
                if (next) next.focus();
                */
            } else if (e.key === 'ArrowRight') {
                const next = document.querySelector(`input[data-row="${r}"][data-col="${c+1}"]`);
                if (next) next.focus();
            } else if (e.key === 'ArrowLeft') {
                const next = document.querySelector(`input[data-row="${r}"][data-col="${c-1}"]`);
                if (next) next.focus();
            } else if (e.key === 'ArrowDown') {
                const next = document.querySelector(`input[data-row="${r+1}"][data-col="${c}"]`);
                if (next) next.focus();
            } else if (e.key === 'ArrowUp') {
                const next = document.querySelector(`input[data-row="${r-1}"][data-col="${c}"]`);
                if (next) next.focus();
            }
        }

        // TIMER
        function startTimer() {
            startTime = Date.now();
            timeElapsed = 0;
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeElapsed = Math.floor((Date.now() - startTime) / 1000);
                const m = Math.floor(timeElapsed / 60).toString().padStart(2, '0');
                const s = (timeElapsed % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function checkAnswers() {
            const inputs = document.querySelectorAll('input');
            let allCorrect = true;
            let filledCount = 0;

            inputs.forEach(inp => {
                if (inp.value.toUpperCase() !== inp.dataset.answer) {
                    allCorrect = false;
                    inp.parentElement.style.backgroundColor = '#fee2e2'; // red-100
                } else {
                    inp.parentElement.style.backgroundColor = '#dcfce7'; // green-100
                }
                if (inp.value) filledCount++;
            });

            if (allCorrect && filledCount === inputs.length) {
                stopTimer();
                showResult(true);
            } else {
                if (filledCount < inputs.length) {
                    // Just feedback
                } else {
                    alert("Masih ada yang salah, ayo semangat!");
                }
            }
        }

        function giveUp() {
            if(confirm("Yakin mau menyerah?")) {
                stopTimer();
                const inputs = document.querySelectorAll('input');
                inputs.forEach(inp => {
                    inp.value = inp.dataset.answer;
                    inp.parentElement.style.backgroundColor = '#fff';
                });
                // Disable inputs
                inputs.forEach(inp => inp.disabled = true);
            }
        }

        // RESULTS
        function showResult(win) {
            const modal = document.getElementById('modal-result');
            const title = document.getElementById('result-title');
            const msg = document.getElementById('result-message');
            const scoreEntry = document.getElementById('score-entry');
            const saveBtn = document.getElementById('save-btn');

            modal.classList.remove('hidden');

            if (win) {
                title.innerText = "Selamat! üéâ";
                const score = Math.max(0, 1000 - (timeElapsed * 2)); // Simple scoring
                msg.innerText = `Kamu menyelesaikan kategori ${currentCategory.toUpperCase()} dalam ${document.getElementById('timer').innerText}.\nSkor: ${score}`;
                modal.dataset.score = score;

                scoreEntry.classList.remove('hidden');
                saveBtn.classList.remove('hidden');
            }
        }

        function closeModal() {
            document.getElementById('modal-result').classList.add('hidden');
        }

        // LEADERBOARD
        function saveScore() {
            const name = document.getElementById('player-name').value;
            if (!name) {
                alert("Masukkan nama dulu ya!");
                return;
            }

            const score = parseInt(document.getElementById('modal-result').dataset.score);
            const entry = {
                name: name,
                category: currentCategory,
                score: score,
                date: new Date().toISOString()
            };

            let lb = JSON.parse(localStorage.getItem('tts_leaderboard') || '[]');
            lb.push(entry);
            lb.sort((a, b) => b.score - a.score);
            lb = lb.slice(0, 10); // Keep top 10

            localStorage.setItem('tts_leaderboard', JSON.stringify(lb));

            closeModal();
            showLeaderboard();
        }

        function renderLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            const lb = JSON.parse(localStorage.getItem('tts_leaderboard') || '[]');
            const noScores = document.getElementById('no-scores');

            list.innerHTML = '';

            if (lb.length === 0) {
                noScores.classList.remove('hidden');
            } else {
                noScores.classList.add('hidden');
                lb.forEach(entry => {
                    const tr = document.createElement('tr');
                    tr.className = 'bg-white border-b';
                    tr.innerHTML = `
                        <td class="px-4 py-3 font-medium text-gray-900">${entry.name}</td>
                        <td class="px-4 py-3 text-gray-500 capitalize">${entry.category}</td>
                        <td class="px-4 py-3 text-right font-bold text-blue-600">${entry.score}</td>
                    `;
                    list.appendChild(tr);
                });
            }
        }

        // Start at Menu
        showMenu();

    </script>
</body>
</html>
